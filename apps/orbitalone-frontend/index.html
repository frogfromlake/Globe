<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TileLoader Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      #attribution {
        position: fixed;
        bottom: 8px;
        right: 12px;
        font-size: 12px;
        color: #ccc;
        background: rgba(0, 0, 0, 0.4);
        padding: 6px 10px;
        border-radius: 4px;
        font-family: sans-serif;
        pointer-events: none;
        user-select: none;
        line-height: 1.4;
      }
      #attribution a {
        color: #ccc;
        text-decoration: underline;
      }
    </style>
  </head>
  <body style="background-color: black;">
    <script type="module" src="/src/core/earth/tileLoader/test/testTileEngineScene.ts"></script>

    <div id="attribution">
      Sentinel-2 cloudless - <a href="https://s2maps.eu" target="_blank">https://s2maps.eu</a> by EOX IT Services GmbH<br />
      (Contains modified Copernicus Sentinel data 2024)
    </div>

    <!-- The debug UI will be injected here -->
    <script type="module">
      import { createDebugUI } from "/src/core/earth/tileLoader/debug/DebugUI";

      // Register your debug features (easy to extend)
      createDebugUI({
        features: [
          { key: "enableFrustumCulling", label: "Frustum Culling", type: "checkbox", default: true },
          { key: "enableDotProductFiltering", label: "Dot Filter", type: "checkbox", default: true },
          { key: "enableScreenSpacePrioritization", label: "Screen Priority", type: "checkbox", default: true },
          { key: "enableCaching", label: "Caching", type: "checkbox", default: true },
          { key: "debugSpiralBounds", label: "Spiral Boxes (Z9+)", type: "checkbox", default: false },
          { key: "enableTileFade", label: "Tile Fade", type: "checkbox", default: false },
        ],
        title: "Tile Debug UI"
      });

      // FPS / stats overlay remains separate (optional, as before)
      const statsDiv = document.createElement("div");
      statsDiv.style.position = "fixed";
      statsDiv.style.bottom = "10px";
      statsDiv.style.left = "10px";
      statsDiv.style.padding = "4px 8px";
      statsDiv.style.background = "rgba(0,0,0,0.6)";
      statsDiv.style.color = "white";
      statsDiv.style.fontFamily = "monospace";
      statsDiv.style.fontSize = "11px";
      statsDiv.style.borderRadius = "4px";
      statsDiv.style.zIndex = "10001";
      statsDiv.style.pointerEvents = "none";
      document.body.appendChild(statsDiv);

      let lastFrame = performance.now();
      function updateStatsOverlay() {
        const now = performance.now();
        const delta = now - lastFrame;
        lastFrame = now;
        const fps = 1000 / delta;

        const camera = window?.dynamicTileManager?.camera;
        const scene = window?.dynamicTileManager?.scene;
        const currentZoom = window?.dynamicTileManager?.currentZoom;
        const tileGroups = scene?.children?.filter?.((c) =>
          c.name?.startsWith("TileGroup_Z")
        ).length;

        statsDiv.textContent = `FPS: ${fps.toFixed(1)} | Zoom: ${
          currentZoom ?? "-"
        } | TileGroups: ${tileGroups ?? "-"}`;
        requestAnimationFrame(updateStatsOverlay);
      }
      updateStatsOverlay();
    </script>
  </body>
</html>
