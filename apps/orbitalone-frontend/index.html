<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TileLoader Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      #attribution {
        position: fixed;
        bottom: 8px;
        right: 12px;
        font-size: 12px;
        color: #ccc;
        background: rgba(0, 0, 0, 0.4);
        padding: 6px 10px;
        border-radius: 4px;
        font-family: sans-serif;
        pointer-events: none;
        user-select: none;
        line-height: 1.4;
      }
      #attribution a {
        color: #ccc;
        text-decoration: underline;
      }
    </style>
  </head>
  <body style="background-color: black;">
    <script type="module" src="/src/core/earth/tileLoader/testTileScene.ts"></script>

    <div id="attribution">
      Sentinel-2 cloudless - <a href="https://s2maps.eu" target="_blank">https://s2maps.eu</a> by EOX IT Services GmbH<br />
      (Contains modified Copernicus Sentinel data 2024)
    </div>

    <!-- âœ… Debug UI Overlay -->
    <div id="tile-debug-ui" style="position:fixed;top:10px;left:10px;background:rgba(0,0,0,0.8);color:white;padding:10px;font-family:sans-serif;font-size:12px;border-radius:8px;z-index:10000">
      <strong>Tile Debug UI</strong><br>
      <label><input type="checkbox" data-feature="enableFrustumCulling" checked> Frustum Culling</label><br>
      <label><input type="checkbox" data-feature="enableDotProductFiltering" checked> Dot Filter</label><br>
      <label><input type="checkbox" data-feature="enableScreenSpacePrioritization" checked> Screen Priority</label><br>
      <label><input type="checkbox" data-feature="enableCaching" checked> Caching</label><br>
      <label><input type="checkbox" id="toggle-spiral-boxes" checked> Spiral Boxes (Z9+)</label><br>

      <div id="camera-info">
        <div>Camera Distance: <span id="camera-distance">-</span></div>
        <div>Current LOD (Z): <span id="current-zoom">-</span></div>
      </div>
    </div>

    <script type="module">
      import { estimateZoomLevel } from "/src/core/earth/tileLoader/utils/lodFunctions";
    
      const checkboxMappings = {
        enableFrustumCulling: true,
        enableDotProductFiltering: true,
        enableScreenSpacePrioritization: true,
        enableCaching: true,
        DEBUG_SPIRAL_BOUNDS: false,
      };
    
      for (const [flag, defaultValue] of Object.entries(checkboxMappings)) {
        window[flag] = defaultValue;
        const input = document.querySelector(`input[data-feature="${flag}"], #toggle-spiral-boxes`);
        if (input instanceof HTMLInputElement) {
          input.checked = defaultValue;
          input.addEventListener("change", () => {
            window[flag] = input.checked;
            console.log(`[TileDebugUI] ${flag} set to`, input.checked);
          });
        }
      }
    
      // Live stats overlay (FPS, zoom, tile count)
      const statsDiv = document.createElement("div");
      statsDiv.style.position = "fixed";
      statsDiv.style.bottom = "10px";
      statsDiv.style.left = "10px";
      statsDiv.style.padding = "4px 8px";
      statsDiv.style.background = "rgba(0,0,0,0.6)";
      statsDiv.style.color = "white";
      statsDiv.style.fontFamily = "monospace";
      statsDiv.style.fontSize = "11px";
      statsDiv.style.borderRadius = "4px";
      statsDiv.style.zIndex = "10001";
      statsDiv.style.pointerEvents = "none";
      document.body.appendChild(statsDiv);
    
      let lastFrame = performance.now();
      function updateStatsOverlay() {
        const now = performance.now();
        const delta = now - lastFrame;
        lastFrame = now;
        const fps = 1000 / delta;
    
        const camera = window?.dynamicTileManager?.camera;
        const scene = window?.dynamicTileManager?.scene;
        const currentZoom = window?.dynamicTileManager?.currentZoom;
        const tileGroups = scene?.children?.filter?.((c) =>
          c.name?.startsWith("TileGroup_Z")
        ).length;
    
        statsDiv.textContent = `FPS: ${fps.toFixed(1)} | Zoom: ${
          currentZoom ?? "-"
        } | TileGroups: ${tileGroups ?? "-"}`;
        requestAnimationFrame(updateStatsOverlay);
      }
      updateStatsOverlay();
    </script>
    
  </body>
</html>
